<div class="container-fluid mt-4">
    <div class="row">
        <!-- Sidebar -->
        <div class="col-md-3 col-lg-2">
            <div class="sidebar p-3 bg-white shadow-sm rounded">
                <h5 class="sidebar-title mb-3 border-bottom pb-2">Панель организатора</h5>
                <ul class="nav flex-column">
                    <li class="nav-item">
                        <a class="nav-link" [class.active]="activeTab === 'dashboard'"
                            (click)="setActiveTab('dashboard')">
                            <i class="bi bi-speedometer2 me-2"></i> Обзор
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" [class.active]="activeTab === 'events'" (click)="setActiveTab('events')">
                            <i class="bi bi-calendar-event me-2"></i> Мои события
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" [class.active]="activeTab === 'participants'"
                            (click)="setActiveTab('participants')">
                            <i class="bi bi-people me-2"></i> Участники
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" routerLink="/">
                            <i class="bi bi-house me-2"></i> На главную
                        </a>
                    </li>
                </ul>
            </div>
        </div>

        <!-- Main content -->
        <div class="col-md-9 col-lg-10">
            <!-- Dashboard overview -->
            <div *ngIf="activeTab === 'dashboard'" class="organizer-content">
                <h2 class="mb-4">Обзор</h2>
                <div class="row">
                    <div class="col-md-4 mb-4">
                        <div class="card stats-card h-100">
                            <div class="card-body">
                                <div class="d-flex align-items-center justify-content-between">
                                    <div>
                                        <h5 class="card-title">Всего событий</h5>
                                        <h2 class="mt-2 mb-0">{{ myEvents.length || 0 }}</h2>
                                    </div>
                                    <i class="bi bi-calendar-event-fill fs-1 text-primary"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4 mb-4">
                        <div class="card stats-card h-100">
                            <div class="card-body">
                                <div class="d-flex align-items-center justify-content-between">
                                    <div>
                                        <h5 class="card-title">Всего участников</h5>
                                        <h2 class="mt-2 mb-0">{{ allParticipiantsCount || 0 }}</h2>
                                    </div>
                                    <i class="bi bi-people-fill fs-1 text-success"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4 mb-4">
                        <div class="card stats-card h-100">
                            <div class="card-body">
                                <div class="d-flex align-items-center justify-content-between">
                                    <div>
                                        <h5 class="card-title">Средний рейтинг</h5>
                                        <h2 class="mt-2 mb-0">{{ averageRating }}/5</h2>
                                    </div>
                                    <i class="bi bi-star-fill fs-1 text-warning"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Actions -->
                <div class="row mb-4">
                    <div class="col-12">
                        <div class="card">
                            <div class="card-header bg-light">
                                <h5 class="mb-0">Быстрые действия</h5>
                            </div>
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-md-4 mb-3 mb-md-0">
                                        <a routerLink="/event-create" class="btn btn-primary d-block">
                                            <i class="bi bi-plus-circle me-2"></i> Создать событие
                                        </a>
                                    </div>
                                    <div class="col-md-4 mb-3 mb-md-0">
                                        <a routerLink="/events" class="btn btn-outline-primary d-block">
                                            <i class="bi bi-eye me-2"></i> Смотреть все события
                                        </a>
                                    </div>
                                    <div class="col-md-4">
                                        <button class="btn btn-outline-secondary d-block" (click)="downloadReport()">
                                            <i class="bi bi-file-earmark-excel me-2"></i> Скачать отчет
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Upcoming events -->
                <!-- <div class="row">
                    <div class="col-md-6 mb-4">
                        <div class="card h-100">
                            <div class="card-header bg-light">
                                <h5 class="mb-0">Ближайшие события</h5>
                            </div>
                            <div class="card-body">
                                <div *ngIf="isLoading" class="text-center">
                                    <div class="spinner-border text-primary" role="status">
                                        <span class="visually-hidden">Загрузка...</span>
                                    </div>
                                </div>
                                <div *ngIf="!isLoading && upcomingEvents.length === 0" class="text-center">
                                    <p>Нет предстоящих событий</p>
                                    <a routerLink="/event-create" class="btn btn-sm btn-primary">Создать событие</a>
                                </div>
                                <ul *ngIf="!isLoading && upcomingEvents.length > 0" class="list-group list-group-flush">
                                    <li *ngFor="let event of upcomingEvents" class="list-group-item">
                                        <div class="d-flex justify-content-between align-items-center">
                                            <div>
                                                <strong>{{ event.title }}</strong>
                                                <div class="text-muted">{{ event.startDate | date:'dd.MM.yyyy, HH:mm' }}
                                                </div>
                                            </div>
                                            <a [routerLink]="['/events', event.id]"
                                                class="btn btn-sm btn-outline-primary">Подробнее</a>
                                        </div>
                                    </li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div> -->
            </div>

            <!-- Events management -->
            <div *ngIf="activeTab === 'events'" class="organizer-content">
                <div class="d-flex justify-content-between align-items-center mb-4">
                    <h2>Мои события</h2>
                    <a routerLink="/event-create" class="btn btn-primary">
                        <i class="bi bi-plus-circle me-2"></i> Создать событие
                    </a>
                </div>

                <!-- Events grid -->
                <div class="row">
                    <div *ngFor="let event of myEvents" class="col-md-4 mb-4">
                        <div class="card h-100 event-card">

                            <div class="card-body">
                                <div class="d-flex justify-content-between">
                                    <h5 class="card-title">{{ event.title }}</h5>
                                    <span class="badge" [ngClass]="isPastEvent(event) ? 'bg-secondary' : 'bg-success'">
                                        {{ isPastEvent(event) ? 'Завершено' : 'Предстоящее' }}
                                    </span>
                                </div>
                                <p class="card-text mb-2">
                                    {{ event.description | slice:0:80 }}{{ event.description.length > 80 ?
                                    '...'
                                    : '' }}
                                </p>
                                <div class="event-details mb-3">
                                    <div class="d-flex justify-content-between align-items-center">
                                        <small><i class="bi bi-calendar"></i> {{ event.startDate |
                                            date:'dd.MM.yyyy' }}</small>
                                        <small><i class="bi bi-people"></i> {{ event.registeredParticipants
                                            }}/{{ event.maxParticipants }}</small>
                                    </div>
                                </div>
                                <div class="d-flex justify-content-between">
                                    <a [routerLink]="['/events', event.id]" class="btn btn-sm btn-outline-primary">
                                        <i class="bi bi-eye me-1"></i> Просмотр
                                    </a>
                                    <div>
                                        <a [routerLink]="['/events/edit', event.id]"
                                            class="btn btn-sm btn-outline-secondary me-2">
                                            <i class="bi bi-pencil"></i>
                                        </a>
                                        <button class="btn btn-sm btn-outline-danger" (click)="deleteEvent(event)">
                                            <i class="bi bi-trash"></i>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- No events message -->
                    <div *ngIf="!isLoadingEvents && myEvents.length === 0" class="text-center my-5">
                        <i class="bi bi-calendar-x display-1 text-muted"></i>
                        <h3 class="mt-3">Событий не найдено</h3>
                        <p class="mb-4">У вас пока нет созданных событий</p>
                    </div>
                </div>
            </div>

            <!-- Participants Tab -->
            <div *ngIf="activeTab === 'participants'" class="organizer-content">
                <h2 class="mb-4">Участники событий</h2>

                <!-- Select event for participants -->
                <div class="card mb-4">
                    <div class="card-body">
                        <div class="row align-items-center">
                            <div class="col-md-6">
                                <label for="eventSelect" class="form-label">Выберите событие</label>
                                <select id="eventSelect" class="form-select" [(ngModel)]="selectedEventId"
                                    (ngModelChange)="loadParticipants()">
                                    <option [ngValue]="null">-- Выберите событие --</option>
                                    <option *ngFor="let event of myEvents" [ngValue]="event.id">{{ event.title }}
                                    </option>
                                </select>
                            </div>
                            <div class="col-md-6">
                                <div *ngIf="selectedEventId" class="d-flex justify-content-end">
                                    <button class="btn btn-outline-success me-2" (click)="exportParticipantsList()">
                                        <i class="bi bi-file-earmark-excel me-1"></i> Экспорт списка
                                    </button>
                                    <button class="btn btn-outline-primary" (click)="sendEmailToParticipants()">
                                        <i class="bi bi-envelope me-1"></i> Отправить уведомление
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Participants table -->
                <div class="card">
                    <div class="card-body">
                        <div *ngIf="isLoadingParticipants" class="text-center my-4">
                            <div class="spinner-border text-primary" role="status">
                                <span class="visually-hidden">Загрузка...</span>
                            </div>
                        </div>

                        <div *ngIf="!selectedEventId && !isLoadingParticipants" class="text-center my-4">
                            <p>Выберите событие, чтобы увидеть список участников</p>
                        </div>

                        <div *ngIf="selectedEventId && !isLoadingParticipants && participants.length === 0"
                            class="text-center my-4">
                            <p>Для выбранного события нет зарегистрированных участников</p>
                        </div>

                        <div *ngIf="selectedEventId && !isLoadingParticipants && participants.length > 0"
                            class="table-responsive">
                            <table class="table table-hover">
                                <thead>
                                    <tr>
                                        <th>#</th>
                                        <th>Имя</th>
                                        <th>Email</th>
                                        <th>Телефон</th>
                                        <th>Статус</th>
                                        <th>Действия</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr *ngFor="let participant of participants; let i = index">
                                        <td>{{ i + 1 }}</td>
                                        <td>{{ participant.name }}</td>
                                        <td>{{ participant.email }}</td>
                                        <td>{{ participant.phoneNumber || 'Не указан' }}</td>
                                        <td>
                                            <span class="badge bg-success">Зарегистрирован</span>
                                        </td>
                                        <td>
                                            <button class="btn btn-sm btn-outline-primary me-1"
                                                (click)="viewParticipantDetails(participant)">
                                                <i class="bi bi-info-circle"></i>
                                            </button>
                                            <button class="btn btn-sm btn-outline-danger"
                                                (click)="removeParticipant(participant)">
                                                <i class="bi bi-person-x"></i>
                                            </button>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Email Modal -->
        <div class="modal fade" id="emailModal" tabindex="-1" aria-labelledby="emailModalLabel" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="emailModalLabel">Отправить уведомление участникам</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <form [formGroup]="emailForm">
                            <div class="mb-3">
                                <label for="emailSubject" class="form-label">Тема</label>
                                <input type="text" class="form-control" id="emailSubject" formControlName="subject">
                            </div>
                            <div class="mb-3">
                                <label for="emailMessage" class="form-label">Сообщение</label>
                                <textarea class="form-control" id="emailMessage" rows="5"
                                    formControlName="message"></textarea>
                            </div>
                        </form>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Отмена</button>
                        <button type="button" class="btn btn-primary" [disabled]="emailForm.invalid || isSendingEmail"
                            (click)="sendEmail()">
                            <span *ngIf="isSendingEmail" class="spinner-border spinner-border-sm me-2"
                                role="status"></span>
                            Отправить
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Participant Details Modal -->
        <div class="modal fade" id="participantDetailsModal" tabindex="-1"
            aria-labelledby="participantDetailsModalLabel" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="participantDetailsModalLabel">Информация об участнике</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <div *ngIf="selectedParticipant">
                            <p><strong>Имя:</strong> {{ selectedParticipant.name }}</p>
                            <p><strong>Email:</strong> {{ selectedParticipant.email }}</p>
                            <p><strong>Телефон:</strong> {{ selectedParticipant.phoneNumber || 'Не указан' }}</p>

                            <!-- Additional participant details can be added here -->
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Закрыть</button>
                        <button type="button" class="btn btn-primary" [disabled]="!selectedParticipant"
                            (click)="selectedParticipant && sendEmailToSingleParticipant(selectedParticipant)">
                            <i class="bi bi-envelope me-2"></i> Отправить сообщение
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>