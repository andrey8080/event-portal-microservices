<div class="container mt-4">
    <div class="row">
        <div class="col-12">
            <h2>Создание нового события</h2>
            <div *ngIf="errorMessage" class="alert alert-danger">{{ errorMessage }}</div>

            <!-- Информация об отладке API Yandex Maps -->
            <!-- <div *ngIf="debugInfo" class="alert alert-info small">
                <strong>Отладочная информация:</strong>
                <pre>{{ debugInfo }}</pre>
                <button class="btn btn-sm btn-outline-secondary" (click)="debugInfo = ''">Скрыть</button>
            </div> -->

            <form [formGroup]="eventForm" (ngSubmit)="onSubmit()" class="mt-3">
                <div class="row">
                    <!-- Левая колонка с основной информацией -->
                    <div class="col-md-6">
                        <div class="mb-3">
                            <label for="title" class="form-label">Название события*</label>
                            <input type="text" id="title" formControlName="title" class="form-control"
                                [ngClass]="{'is-invalid': eventForm.get('title')?.invalid && eventForm.get('title')?.touched}">
                            <div class="invalid-feedback"
                                *ngIf="eventForm.get('title')?.invalid && eventForm.get('title')?.touched">
                                Название события обязательно
                            </div>
                        </div>

                        <div class="mb-3">
                            <label for="description" class="form-label">Описание события*</label>
                            <textarea id="description" formControlName="description" class="form-control" rows="5"
                                [ngClass]="{'is-invalid': eventForm.get('description')?.invalid && eventForm.get('description')?.touched}"></textarea>
                            <div class="invalid-feedback"
                                *ngIf="eventForm.get('description')?.invalid && eventForm.get('description')?.touched">
                                Описание события обязательно
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="startDate" class="form-label">Дата начала*</label>
                                    <input type="date" id="startDate" formControlName="startDate" class="form-control"
                                        [ngClass]="{'is-invalid': eventForm.get('startDate')?.invalid && eventForm.get('startDate')?.touched}">
                                    <div class="invalid-feedback"
                                        *ngIf="eventForm.get('startDate')?.invalid && eventForm.get('startDate')?.touched">
                                        Дата начала обязательна
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="startTime" class="form-label">Время начала*</label>
                                    <input type="time" id="startTime" formControlName="startTime" class="form-control"
                                        [ngClass]="{'is-invalid': eventForm.get('startTime')?.invalid && eventForm.get('startTime')?.touched}">
                                    <div class="invalid-feedback"
                                        *ngIf="eventForm.get('startTime')?.invalid && eventForm.get('startTime')?.touched">
                                        Время начала обязательно
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="endDate" class="form-label">Дата окончания*</label>
                                    <input type="date" id="endDate" formControlName="endDate" class="form-control"
                                        [ngClass]="{'is-invalid': eventForm.get('endDate')?.invalid && eventForm.get('endDate')?.touched}">
                                    <div class="invalid-feedback"
                                        *ngIf="eventForm.get('endDate')?.invalid && eventForm.get('endDate')?.touched">
                                        Дата окончания обязательна
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="endTime" class="form-label">Время окончания*</label>
                                    <input type="time" id="endTime" formControlName="endTime" class="form-control"
                                        [ngClass]="{'is-invalid': eventForm.get('endTime')?.invalid && eventForm.get('endTime')?.touched}">
                                    <div class="invalid-feedback"
                                        *ngIf="eventForm.get('endTime')?.invalid && eventForm.get('endTime')?.touched">
                                        Время окончания обязательно
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="price" class="form-label">Стоимость (руб.)*</label>
                                    <input type="number" id="price" formControlName="price" class="form-control"
                                        [ngClass]="{'is-invalid': eventForm.get('price')?.invalid && eventForm.get('price')?.touched}">
                                    <div class="invalid-feedback"
                                        *ngIf="eventForm.get('price')?.invalid && eventForm.get('price')?.touched">
                                        Стоимость должна быть положительным числом
                                    </div>
                                    <small class="text-muted">Введите 0 для бесплатных событий</small>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="maxParticipants" class="form-label">Макс. участников*</label>
                                    <input type="number" id="maxParticipants" formControlName="maxParticipants"
                                        class="form-control"
                                        [ngClass]="{'is-invalid': eventForm.get('maxParticipants')?.invalid && eventForm.get('maxParticipants')?.touched}">
                                    <div class="invalid-feedback"
                                        *ngIf="eventForm.get('maxParticipants')?.invalid && eventForm.get('maxParticipants')?.touched">
                                        Максимальное количество участников должно быть указано
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- <div class="mb-3 form-check">
                            <input type="checkbox" id="hasQuiz" formControlName="hasQuiz" class="form-check-input">
                            <label for="hasQuiz" class="form-check-label">Включить викторину для участников</label>
                            <small class="text-muted d-block">Вы сможете создать викторину после создания
                                события</small>
                        </div> -->
                    </div>

                    <!-- Правая колонка с картой и загрузкой изображений -->
                    <div class="col-md-6">
                        <div class="mb-3">
                            <label for="address-input" class="form-label">Адрес проведения*</label>
                            <div class="input-group">
                                <input type="text" id="address-input" formControlName="address" class="form-control"
                                    [ngClass]="{'is-invalid': eventForm.get('address')?.invalid && eventForm.get('address')?.touched}">
                                <button type="button" class="btn btn-outline-secondary" (click)="findCoordinates()">
                                    <i class="bi bi-search"></i> Найти
                                </button>
                            </div>
                            <div class="invalid-feedback"
                                *ngIf="eventForm.get('address')?.invalid && eventForm.get('address')?.touched">
                                Адрес обязателен
                            </div>
                        </div>

                        <div class="mb-3">
                            <div class="map-container">
                                <div id="map-preview" style="width: 100%; height: 250px;"></div>
                            </div>
                            <input type="hidden" formControlName="latitude">
                            <input type="hidden" formControlName="longitude">
                        </div>

                        <!-- <div class="mb-4">
                            <label class="form-label">Загрузить изображения</label>
                            <div class="mb-2">
                                <input type="file" id="images" accept="image/*" multiple class="form-control"
                                    (change)="onImagesSelected($event)">
                            </div>
                            <div class="form-text">Максимум 5 изображений. Поддерживаемые форматы: JPG, PNG.</div>

                            <div *ngIf="imagePreviews.length > 0" class="image-previews mt-3">
                                <div *ngFor="let preview of imagePreviews; let i = index"
                                    class="image-preview-container">
                                    <img [src]="preview" alt="Preview" class="img-thumbnail">
                                    <button type="button" class="btn btn-sm btn-danger remove-image"
                                        (click)="removeImage(i)">
                                        <i class="bi bi-trash"></i>
                                    </button>
                                </div>
                            </div>
                        </div> -->
                    </div>
                </div>

                <div class="d-grid gap-2 d-md-flex justify-content-md-end mt-3">
                    <button type="button" class="btn btn-outline-secondary me-md-2" routerLink="/events">Отмена</button>
                    <button type="submit" class="btn btn-primary" [disabled]="eventForm.invalid || isSubmitting">
                        <span *ngIf="isSubmitting" class="spinner-border spinner-border-sm me-1" role="status"
                            aria-hidden="true"></span>
                        Создать событие
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>